<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="icon" href="http://benkent.servehttp.com/mealmanager/favicon.ico" type="image/x-icon" /><link rel="shortcut icon" href="http://benkent.servehttp.com/mealmanager/favicon.ico" type="image/x-icon" /><meta name="HandheldFriendly" content="true" /><meta name="MobileOptimized" content="320" /><meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scaleable=no, width=device-width" /><title>Meal Library</title><link rel="stylesheet" href="mealmanager.css"></head><?phpinclude "../db/functions.php";//Check if user is legitimately logged insession_start();if (!isset($_SESSION["valid_user"])){	// User not logged in, redirect to login page	header("Location: index.php");	exit();}$datetoday = date('d/m/Y');$q = @$_POST["q"];$ordby = @$_POST["o"];$pagenum = @$_POST["p"];if (!isset($_POST["p"])){	$pagenum  = 1;}echo "<body OnLoad=";?>"<? echo "document.form.q.focus()";?>"<? echo "><div align='center'><div class='searchbar'>Logged in as <a href='userstats.php'>". $_SESSION["short_name"] ."</a>&nbsp;</div>      <div class='searchbar'><form name='form' id='form' method='post' action='home.php'><input type='text' name='q' id='q' value='$q' size='30' />      <input type='submit' name='Search' value='Search' /></form></div>	  <div class='searchbar'><form name='formp' method='post' action='home.php'>      <input type='submit' name='planner' value='Planner' /></form></div>	  <div class='searchbar'><form name='formre' method='post' action='library.php'>	  <input type='hidden' name='o' value='ct' />      <input type='submit' name='Recent' value='Recent' /></form></div>	  <div class='searchbar'><form name='formadd' method='post' action='addmeal.php'>      <input type='submit' name='addmeal' value='Add Meal' /></form></div>	  <div class='searchbar'><form method='post' action='library.php' name='formreset'>	  <input type='submit' name='reset' value='Reset Search' /></form></div>	  <div class='searchbar'><form name='formlogout' method='post' action='logout.php'>      <input type='submit' name='logout' value='Log Out' /></form></div></div>      <div class='maintabdiv'><table>		<tr>		<th>Title</th>		<th>Category</th>		<th>Added</th>		<th>Last eaten</th>		<th>Notes</th>		</tr>";$mysqli = iConnect("mealmanager");$qdata = "select *  from meals  where title like '%$q%'";  //echo "$ordby"; if ($ordby != ""){	if ($ordby == "dt")        $qdata .= " order by addeddt desc";    if ($ordby == "ct")	    $qdata .= " order by lasteatendt desc";}else    $qdata .= " order by title";  //$qdata .= " order by addeddt desc";$data = $mysqli->query($qdata); //echo "$qdata";   $num_rows = $data->num_rows;//This is the number of results displayed per page$page_rows = 50;//This tells us the page number of our last page $last = ceil($num_rows/$page_rows);//this makes sure the page number isn't below one, or more than our maximum pages if ($pagenum < 1) { 	$pagenum = 1; } elseif ($pagenum > $last) { 	$pagenum = $last; }   //This sets the range to display in our query $max = " LIMIT " .($pagenum - 1) * $page_rows ."," .$page_rows;$qdata .= $max;// run the query again with the limit clause$data = $mysqli->query($qdata); if ($num_rows > 0){    $i = 1;	while ($row = $data->fetch_array())	{	    if ($i % 2 == 0) {  // if i is an even number            $trclass = "class='alt'";        }		else {		    $trclass="";		}		$id = $row['id'];		$title = $row['title'];		$category = $row['category'];		$addeddt = $row['addeddt'];		$addeddt = date('d/m/Y',strtotime($addeddt));		if ($addeddt == "01/01/1970")		    $addeddt = "N/A";		$lasteatendt = $row['lasteatendt'];		$lasteatendt = date('d/m/Y',strtotime($lasteatendt));		if ($lasteatendt == "01/01/1970")		    $lasteatendt = "N/A";		$notes = $row['notes'];				echo "<tr $trclass align='left'>";		echo "<td width='auto'><form name='tform$i' action='ingredients.php' method='post'>		<input type='hidden' name='id' value='$id' />		<input type='hidden' name='name' value='$title' /></form>		<a href='#' onclick=";		?>"<? echo "document.tform$i.submit();return false;";		?>"<? echo " >$title</a></td>";		echo "<td width='auto'>$category</td>";		echo "<td width='auto'>$addeddt</td>";		echo "<td width='auto'>$lasteatendt</td>";		echo "<td width='auto'>$notes</td>";		echo "</tr>";				$i++;	}		if ($num_rows==1)		$results = "title";	else		$results = "titles";		echo "</table></div><div class='maintabdiv'>";		echo "<div align='center'>";// First we check if we are on page one. If we are then we don't need a link to the previous page or the first page so we do nothing. If we aren't then we generate links to the first page, and to the previous page.if ($pagenum == 1) {	$firstbuttonenabled = "disabled='disabled'";}else{	$firstbuttonenabled = "";}echo " <div class='searchbar'><form name='formpagefirst' id='formpagefirst' method='post' action='home.php'><input type='submit' name='first' value='<<' $firstbuttonenabled /><input type='hidden' name='q' value='$q' /><input type='hidden' name='o' value='$ordby' /><input type='hidden' name='p' value='1' /></form></div>";$previous = $pagenum-1;echo " <div class='searchbar'><form name='formpageprevious' id='formpageprevious' method='post' action='home.php'><input type='submit' name='previous' value='<' $firstbuttonenabled /><input type='hidden' name='q' value='$q' /><input type='hidden' name='o' value='$ordby' /><input type='hidden' name='p' value='$previous' /></form></div>";//This does the same as above, only checking if we are on the last page, and then generating the Next and Last linksif ($pagenum == $last) {	$lastbuttonenabled = "disabled='disabled'";}else{	$lastbuttonenabled = "";}$next = $pagenum+1;echo " <div class='searchbar'><form name='formpagenext' id='formpagenext' method='post' action='home.php'><input type='submit' name='next' value='>' $lastbuttonenabled /><input type='hidden' name='q' value='$q' /><input type='hidden' name='o' value='$ordby' /><input type='hidden' name='p' value='$next' /></form></div>";echo " <div class='searchbar'><form name='formpagelast' id='formpagelast' method='post' action='home.php'><input type='submit' name='last' value='>>' $lastbuttonenabled /><input type='hidden' name='q' value='$q' /><input type='hidden' name='o' value='$ordby' /><input type='hidden' name='p' value='$last' /></form></div>";echo "<div class='searchbar'>Page $pagenum of $last &nbsp;</div>";		echo "<div class='searchbar'>| $num_rows $results	</div></div>	</div></body></html>"; }?>